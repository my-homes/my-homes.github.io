<!DOCTYPE html>
<html>
<head>
    <base target="_top" />
    <title>Random 02/19-00:01</title>
    <link rel="stylesheet" href="jquery-ajax.css" />
    <script src="https://code.jquery.com/jquery-4.0.0.js" integrity="sha256-9fsHeVnKBvqh3FB2HYu7g2xseAZ5MlN6Kz/qnkASV8U=" crossorigin="anonymous"></script>
</head>
<body>
<h1>Random Youtube Playlist</h1>

<style>
.example{
    font-size: 600%;
}
</style>

<p><button id="ajax" class="example">Open Random Playlist.</button></p>

<div id="overlay">
  <div class="cv-spinner">
    <span class="spinner"></span>
  </div>
</div>
<script>
    $(function() {
        $(document).ajaxSend(function() {
            $("#overlay").fadeIn(300);
        });
        $('#ajax').on('click',function(){
            $.ajax({
                //crossDomain: true,
                url:'https://script.google.com/macros/s/AKfycby3PLSwXczX9DhNcbhlEhdJ0_Qc_4KiOZ2zu1PgzoUV9IPod7uBX8miQquPrp0KVJfQ/exec',
                type:'GET',
                dataType: 'jsonp', // クロスドメイン制限を避けるため
                data:{　'length': 3　}
                })
                .done( (data) => {
                    window.open(data.url, '_blank', 'noopener');})
                .fail( (jqXHR, textStatus, errorThrown) => {
                    alert('Ajax通信に失敗しました。');
                    console.log("jqXHR          : " + jqXHR.status); // HTTPステータスを表示
                    console.log("textStatus     : " + textStatus);    // タイムアウト、パースエラーなどのエラー情報を表示
                    console.log("errorThrown    : " + errorThrown.message); // 例外情報を表示
                    })
                .always( (data) => {
                    setTimeout(function() {　$("#overlay").fadeOut(300);　}, 500);　});
            });
        });
</script>
</body>
</html>
